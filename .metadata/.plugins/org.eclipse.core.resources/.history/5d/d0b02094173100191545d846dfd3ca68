package tictactoe;

import java.util.Scanner;

public class SpieleEngine {
	private Spielbrett brett = new Spielbrett();
	private Scanner scanner = new Scanner(System.in);
	private int spieler = 1;
	private GrafikEngine grafik = new GrafikEngine();

	public void naechstenSpielzugBeginnen() {
		grafik.ausgabe(brett.ausgabe());
		inputVerarbeiten();
	}

	private void inputVerarbeiten() {
		System.out.print("Kommando: ");
		String kommando = scanner.next();
		try {
			eingabeVerarbeiten(kommando);
		} catch(Exception e){
			System.out.println(e.getMessage());
			inputVerarbeiten();
		}
	}
	
	private void spielstandEvaluieren() {
		if (unentschieden()) {
			System.out.println("Unentschieden. Entweder neu oder ende wählen.");
			naechstenSpielzugBeginnen();
		} else if (spielerEinsGewinnt()) {
			System.out.println("Spieler 1 gewinnt. Entweder neu oder ende wählen.");
			naechstenSpielzugBeginnen();
		} else if (spielerZweiGewinnt()) {
			System.out.println("Spieler 2 gewinnt. Entweder neu oder ende wählen.");
			naechstenSpielzugBeginnen();
		} else {
			naechstenSpielzugBeginnen();
		}
	}

	private boolean unentschieden() {
		return brett.isJedesFeldBelegt();
	}

	private boolean spielerZweiGewinnt() {
		return brett.hasZahlEineReihe(2);
	}

	private boolean spielerEinsGewinnt() {
		return brett.hasZahlEineReihe(1);
	}

	private void eingabeVerarbeiten(String kommando) throws Exception {
		//TODO: Spiel geht nach Zug weiter
		switch (kommando) {
			case "A0": spielzugDurchführen(0); break;
			case "B0": spielzugDurchführen(1); spielstandEvaluieren(); break;
			case "C0": spielzugDurchführen(2); spielerWechsel(); spielstandEvaluieren(); break;
	        case "A1": spielzugDurchführen(3); spielerWechsel(); spielstandEvaluieren(); break;
	        case "B1": spielzugDurchführen(4); spielerWechsel(); spielstandEvaluieren(); break;
	        case "C1": spielzugDurchführen(5); spielerWechsel(); spielstandEvaluieren(); break;
	        case "A2": spielzugDurchführen(6); spielerWechsel(); spielstandEvaluieren(); break;
	        case "B2": spielzugDurchführen(7); spielerWechsel(); spielstandEvaluieren(); break;
	        case "C2": spielzugDurchführen(8); spielerWechsel(); spielstandEvaluieren(); break;
	        case "neu": brett = new Spielbrett(); this.naechstenSpielzugBeginnen(); break;
	        case "ende": break;
	        default:
	        	throw new Exception("Ungültiger Befehl.");
		}	
	}

	private void spielzugDurchführen(int spielfeld) throws Exception {
		brett.zug(0, spieler);
		spielerWechsel();
		spielstandEvaluieren();
	}

	private void spielerWechsel() {
		if (spieler == 1) spieler ++;
		else spieler--;
	}
		
	public static void main(String [] args) {
		new SpieleEngine().naechstenSpielzugBeginnen();
	}
}
